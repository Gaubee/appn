import{S as u,i as g,p as f,s as y}from"./index-DQVJQVzh.js";import"./css-color-mix-Dql-TA3k.js";class S{finished;ready;updateCallbackDone;__skipTransitionCallback;__skipped=!1;skipTransition(){this.__skipped||(this.__skipped=!0,this.__skipTransitionCallback())}constructor(t,e,n,i){this.finished=t,this.ready=e,this.updateCallbackDone=n,this.__skipTransitionCallback=i}}class v extends u{getSelector(t,e){return"."+super.getSelector(t,e).replace(/[:(*)]/g,n=>`\\${n}`)}isSharedElementAnimation(t){const{effect:e}=t;if(e instanceof KeyframeEffect&&e.target&&g(e.target.classList,n=>n.startsWith(this.selectorPrefix)))return t}async transition(t,e,n){const i=new Map,o=new Map;await e?.first?.();{const s=this.__getPagesContext("first",n);for(const a of["from","dest"]){const r=s[a]?.node;r&&this.__captureSharedElementsStyle(r,i)}}const l=f(),c=f(),p=f(),h=s=>{p.reject(s),c.reject(s),l.reject(s)},d=new S(l.promise,c.promise,p.promise,()=>{});try{(async()=>{try{await e.last?.();{const a=this.__getPagesContext("last",n);for(const r of["dest","from"]){const m=a[r]?.node;m&&this.__captureSharedElementsStyle(m,o)}}p.resolve();const s=[];c.resolve(),Promise.all(s.map(a=>a.finished)).then(()=>l.resolve())}catch(s){h(s)}})(),await e?.start?.(d),await d.finished,await e.finish?.(d)}catch(s){h(s)}}constructor(){super();const t=String.raw;this.css.addRules(t`appn-navigation-history-entry[data-from-tense=present]{transition-duration:var(--page-leave-duration);transition-timing-function:var(--page-leave-ease)}appn-navigation-history-entry[data-tense=present]{transition-duration:var(--page-enter-duration);transition-timing-function:var(--page-enter-ease)}`)}__captureSharedElementsStyle(t,e){for(const{element:n,config:i}of y.queryAllWithConfig(t)){const o=n.getBoundingClientRect();e.set(i.name,{boudingRect:o})}}}const C=new v;export{v as SharedElementPonyfill,C as sharedElementPonyfill};
