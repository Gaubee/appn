const f=Symbol.for("@ts-pattern/matcher"),P=Symbol.for("@ts-pattern/isVariadic"),E="@ts-pattern/anonymous-select-key",T=t=>!!(t&&typeof t=="object"),x=t=>t&&!!t[f],u=(t,e,n)=>{if(x(t)){const r=t[f](),{matched:i,selections:o}=r.match(e);return i&&o&&Object.keys(o).forEach(a=>n(a,o[a])),i}if(T(t)){if(!T(e))return!1;if(Array.isArray(t)){if(!Array.isArray(e))return!1;let r=[],i=[],o=[];for(const a of t.keys()){const h=t[a];x(h)&&h[P]?o.push(h):o.length?i.push(h):r.push(h)}if(o.length){if(o.length>1)throw new Error("Pattern error: Using `...P.array(...)` several times in a single pattern is not allowed.");if(e.length<r.length+i.length)return!1;const a=e.slice(0,r.length),h=i.length===0?[]:e.slice(-i.length),S=e.slice(r.length,i.length===0?1/0:-i.length);return r.every((p,O)=>u(p,a[O],n))&&i.every((p,O)=>u(p,h[O],n))&&(o.length===0||u(o[0],S,n))}return t.length===e.length&&t.every((a,h)=>u(a,e[h],n))}return Reflect.ownKeys(t).every(r=>{const i=t[r];return(r in e||x(o=i)&&o[f]().matcherType==="optional")&&u(i,e[r],n);var o})}return Object.is(e,t)},g=t=>{var e,n,r;return T(t)?x(t)?(e=(n=(r=t[f]()).getSelectionKeys)==null?void 0:n.call(r))!=null?e:[]:Array.isArray(t)?j(t,g):j(Object.values(t),g):[]},j=(t,e)=>t.reduce((n,r)=>n.concat(e(r)),[]);function $(...t){if(t.length===1){const[e]=t;return n=>u(e,n,()=>{})}if(t.length===2){const[e,n]=t;return u(e,n,()=>{})}throw new Error(`isMatching wasn't given the right number of arguments: expected 1 or 2, received ${t.length}.`)}function l(t){return Object.assign(t,{optional:()=>N(t),and:e=>c(t,e),or:e=>W(t,e),select:e=>e===void 0?K(t):K(e,t)})}function B(t){return Object.assign((e=>Object.assign(e,{[Symbol.iterator](){let n=0;const r=[{value:Object.assign(e,{[P]:!0}),done:!1},{done:!0,value:void 0}];return{next:()=>{var i;return(i=r[n++])!=null?i:r.at(-1)}}}}))(t),{optional:()=>B(N(t)),select:e=>B(e===void 0?K(t):K(e,t))})}function N(t){return l({[f]:()=>({match:e=>{let n={};const r=(i,o)=>{n[i]=o};return e===void 0?(g(t).forEach(i=>r(i,void 0)),{matched:!0,selections:n}):{matched:u(t,e,r),selections:n}},getSelectionKeys:()=>g(t),matcherType:"optional"})})}const z=(t,e)=>{for(const n of t)if(!e(n))return!1;return!0},L=(t,e)=>{for(const[n,r]of t.entries())if(!e(r,n))return!1;return!0};function c(...t){return l({[f]:()=>({match:e=>{let n={};const r=(i,o)=>{n[i]=o};return{matched:t.every(i=>u(i,e,r)),selections:n}},getSelectionKeys:()=>j(t,g),matcherType:"and"})})}function W(...t){return l({[f]:()=>({match:e=>{let n={};const r=(i,o)=>{n[i]=o};return j(t,g).forEach(i=>r(i,void 0)),{matched:t.some(i=>u(i,e,r)),selections:n}},getSelectionKeys:()=>j(t,g),matcherType:"or"})})}function s(t){return{[f]:()=>({match:e=>({matched:!!t(e)})})}}function K(...t){const e=typeof t[0]=="string"?t[0]:void 0,n=t.length===2?t[1]:typeof t[0]=="string"?void 0:t[0];return l({[f]:()=>({match:r=>{let i={[e??E]:r};return{matched:n===void 0||u(n,r,(o,a)=>{i[o]=a}),selections:i}},getSelectionKeys:()=>[e??E].concat(n===void 0?[]:g(n))})})}function m(t){return typeof t=="number"}function y(t){return typeof t=="string"}function v(t){return typeof t=="bigint"}const _=l(s(function(t){return!0})),M=_,b=t=>Object.assign(l(t),{startsWith:e=>{return b(c(t,(n=e,s(r=>y(r)&&r.startsWith(n)))));var n},endsWith:e=>{return b(c(t,(n=e,s(r=>y(r)&&r.endsWith(n)))));var n},minLength:e=>b(c(t,(n=>s(r=>y(r)&&r.length>=n))(e))),length:e=>b(c(t,(n=>s(r=>y(r)&&r.length===n))(e))),maxLength:e=>b(c(t,(n=>s(r=>y(r)&&r.length<=n))(e))),includes:e=>{return b(c(t,(n=e,s(r=>y(r)&&r.includes(n)))));var n},regex:e=>{return b(c(t,(n=e,s(r=>y(r)&&!!r.match(n)))));var n}}),F=b(s(y)),d=t=>Object.assign(l(t),{between:(e,n)=>d(c(t,((r,i)=>s(o=>m(o)&&r<=o&&i>=o))(e,n))),lt:e=>d(c(t,(n=>s(r=>m(r)&&r<n))(e))),gt:e=>d(c(t,(n=>s(r=>m(r)&&r>n))(e))),lte:e=>d(c(t,(n=>s(r=>m(r)&&r<=n))(e))),gte:e=>d(c(t,(n=>s(r=>m(r)&&r>=n))(e))),int:()=>d(c(t,s(e=>m(e)&&Number.isInteger(e)))),finite:()=>d(c(t,s(e=>m(e)&&Number.isFinite(e)))),positive:()=>d(c(t,s(e=>m(e)&&e>0))),negative:()=>d(c(t,s(e=>m(e)&&e<0)))}),I=d(s(m)),w=t=>Object.assign(l(t),{between:(e,n)=>w(c(t,((r,i)=>s(o=>v(o)&&r<=o&&i>=o))(e,n))),lt:e=>w(c(t,(n=>s(r=>v(r)&&r<n))(e))),gt:e=>w(c(t,(n=>s(r=>v(r)&&r>n))(e))),lte:e=>w(c(t,(n=>s(r=>v(r)&&r<=n))(e))),gte:e=>w(c(t,(n=>s(r=>v(r)&&r>=n))(e))),positive:()=>w(c(t,s(e=>v(e)&&e>0))),negative:()=>w(c(t,s(e=>v(e)&&e<0)))}),J=w(s(v)),R=l(s(function(t){return typeof t=="boolean"})),U=l(s(function(t){return typeof t=="symbol"})),V=l(s(function(t){return t==null})),q=l(s(function(t){return t!=null}));var G={__proto__:null,matcher:f,optional:N,array:function(...t){return B({[f]:()=>({match:e=>{if(!Array.isArray(e))return{matched:!1};if(t.length===0)return{matched:!0};const n=t[0];let r={};if(e.length===0)return g(n).forEach(o=>{r[o]=[]}),{matched:!0,selections:r};const i=(o,a)=>{r[o]=(r[o]||[]).concat([a])};return{matched:e.every(o=>u(n,o,i)),selections:r}},getSelectionKeys:()=>t.length===0?[]:g(t[0])})})},set:function(...t){return l({[f]:()=>({match:e=>{if(!(e instanceof Set))return{matched:!1};let n={};if(e.size===0)return{matched:!0,selections:n};if(t.length===0)return{matched:!0};const r=(o,a)=>{n[o]=(n[o]||[]).concat([a])},i=t[0];return{matched:z(e,o=>u(i,o,r)),selections:n}},getSelectionKeys:()=>t.length===0?[]:g(t[0])})})},map:function(...t){return l({[f]:()=>({match:e=>{if(!(e instanceof Map))return{matched:!1};let n={};if(e.size===0)return{matched:!0,selections:n};const r=(h,S)=>{n[h]=(n[h]||[]).concat([S])};if(t.length===0)return{matched:!0};var i;if(t.length===1)throw new Error(`\`P.map\` wasn't given enough arguments. Expected (key, value), received ${(i=t[0])==null?void 0:i.toString()}`);const[o,a]=t;return{matched:L(e,(h,S)=>{const p=u(o,S,r),O=u(a,h,r);return p&&O}),selections:n}},getSelectionKeys:()=>t.length===0?[]:[...g(t[0]),...g(t[1])]})})},intersection:c,union:W,not:function(t){return l({[f]:()=>({match:e=>({matched:!u(t,e,()=>{})}),getSelectionKeys:()=>[],matcherType:"not"})})},when:s,select:K,any:_,_:M,string:F,number:I,bigint:J,boolean:R,symbol:U,nullish:V,nonNullable:q,instanceOf:function(t){return l(s(function(e){return n=>n instanceof e}(t)))},shape:function(t){return l(s($(t)))}};class C extends Error{constructor(e){let n;try{n=JSON.stringify(e)}catch{n=e}super(`Pattern matching error: no pattern matches value ${n}`),this.input=void 0,this.input=e}}const k={matched:!1,value:void 0};function H(t){return new A(t,k)}class A{constructor(e,n){this.input=void 0,this.state=void 0,this.input=e,this.state=n}with(...e){if(this.state.matched)return this;const n=e[e.length-1],r=[e[0]];let i;e.length===3&&typeof e[1]=="function"?i=e[1]:e.length>2&&r.push(...e.slice(1,e.length-1));let o=!1,a={};const h=(p,O)=>{o=!0,a[p]=O},S=!r.some(p=>u(p,this.input,h))||i&&!i(this.input)?k:{matched:!0,value:n(o?E in a?a[E]:a:this.input,this.input)};return new A(this.input,S)}when(e,n){if(this.state.matched)return this;const r=!!e(this.input);return new A(this.input,r?{matched:!0,value:n(this.input,this.input)}:k)}otherwise(e){return this.state.matched?this.state.value:e(this.input)}exhaustive(e=D){return this.state.matched?this.state.value:e(this.input)}run(){return this.exhaustive()}returnType(){return this}}function D(t){throw new C(t)}export{G as N,H as z};
