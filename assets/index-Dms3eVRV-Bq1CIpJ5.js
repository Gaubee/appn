import{S as _,i as g,p as y,s as w}from"./index-DcIS0riS.js";import{u as b,l as E}from"./css-color-mix-Bc6Os1iC.js";const u=s=>Symbol.iterator in s?s:{[Symbol.iterator](){return s}},f=s=>t=>v(t,s),v=(s,t)=>{const e=Set.prototype[s];if(typeof e=="function")return b(e);const n=E(t);return Object.defineProperty(Set.prototype,s,{value:n,writable:!0,enumerable:!1,configurable:!0}),t};f((s,t)=>{p(t);const e=new Set(s);for(const n of u(t.keys()))e.add(n);return e})("union");const k=f((s,t)=>{p(t);let e,n;s.size<=t.size?(e=s,n=t):(e=t.keys(),n=s);const r=new Set;for(const a of u(e))n.has(a)&&r.add(a);return r})("intersection");f((s,t)=>{p(t);const e=new Set(s);if(s.size<=t.size)for(const n of s)t.has(n)&&e.delete(n);else for(const n of u(t.keys()))e.has(n)&&e.delete(n);return e})("difference");f((s,t)=>{p(t);const e=new Set(s);for(const n of u(t.keys()))s.has(n)?e.delete(n):e.add(n);return e})("symmetricDifference");f((s,t)=>{p(t);for(const e of s)if(!t.has(e))return!1;return!0})("isSubsetOf");f((s,t)=>{p(t);for(const e of u(t.keys()))if(!s.has(e))return!1;return!0})("isSupersetOf");f((s,t)=>{if(p(t),s.size<=t.size){for(const e of s)if(t.has(e))return!1}else for(const e of u(t.keys()))if(s.has(e))return!1;return!0})("isDisjointFrom");function p(s){if(!x(s))throw new TypeError;const t=s.size,e=Number(t);if(Number.isNaN(e))throw new TypeError;if(typeof s.has!="function")throw new TypeError;if(typeof s.keys!="function")throw new TypeError}function x(s){if(s===null)return!1;const t=typeof s;return t==="object"||t==="function"}class C{finished;ready;updateCallbackDone;__skipTransitionCallback;__skipped=!1;skipTransition(){this.__skipped||(this.__skipped=!0,this.__skipTransitionCallback())}constructor(t,e,n,r){this.finished=t,this.ready=e,this.updateCallbackDone=n,this.__skipTransitionCallback=r}}class A extends _{getSelector(t,e){return"."+super.getSelector(t,e).replace(/[:(*)]/g,n=>`\\${n}`)}isSharedElementAnimation(t){const{effect:e}=t;if(e instanceof KeyframeEffect&&e.target&&g(e.target.classList,n=>n.startsWith(this.selectorPrefix)))return t}async transition(t,e,n){const r=new Map,a=new Map;new Set(r.keys()).intersection(a),await e?.first?.(),this.__captureLifecycleSharedElementsStyle(n,"first",r);const o=y(),l=y(),c=y(),m=i=>{c.reject(i),l.reject(i),o.reject(i)},d=new C(o.promise,l.promise,c.promise,()=>{});try{(async()=>{try{await e.last?.(),this.__captureLifecycleSharedElementsStyle(n,"last",a),c.resolve();const i=this.__buildSharedElementAnimations(r,a);l.resolve(),Promise.all(i.map(h=>h.finished)).then(()=>o.resolve())}catch(i){m(i)}})(),await e?.start?.(d),await d.finished,await e.finish?.(d)}catch(i){m(i)}}constructor(){super();const t=String.raw;this.css.addRules(t`appn-navigation-history-entry[data-from-tense=present]{transition-duration:var(--page-leave-duration);transition-timing-function:var(--page-leave-ease)}appn-navigation-history-entry[data-tense=present]{transition-duration:var(--page-enter-duration);transition-timing-function:var(--page-enter-ease)}`)}__captureLifecycleSharedElementsStyle(t,e,n=new Map){const r=this.__getPagesContext("last",t),{dest:a,from:o}=r;if(a==null||o==null)return n;const l=new Map(w.queryAllWithConfig(o.node).map(i=>[i.name,i])),c=new Map(w.queryAllWithConfig(a.node).map(i=>[i.name,i])),m=k(new Set(l.keys()),c),d=e==="first"?l:c;for(const i of m){const{element:h}=d.get(i),S=h.getBoundingClientRect();typeof h.showPopover=="function"&&n.set(i,{element:h,boudingRect:S,popover:h.popover})}return n}__doAni(t,e,n){const r=t.element;r.popover="manual",r.showPopover();const a={margin:0,overflow:"hidden",borderWidth:0,outline:"1px solid #0003",transformOrigin:"top left",inset:0},o=r.animate([{...a,offset:0,top:e.top+"px",left:e.left+"px",...t.boudingRect===e?{width:e.width+"px",height:e.height+"px",scale:"1 1"}:{width:n.width+"px",height:n.height+"px",scale:`${e.width/n.width} ${e.height/n.height}`}},{...a,offset:1,top:n.top+"px",left:n.left+"px",...t.boudingRect===e?{scale:`${n.width/e.width} ${n.height/e.height}`}:{scale:"1 1"}}],{duration:this.pageAnimationDuration});return o.finished.finally(()=>{t.popover&&r.hidePopover(),r.popover=t.popover}),o}__buildSharedElementAnimations(t,e){const n=[];for(const[r,a]of t){if(!e.has(r))continue;const o=e.get(r);console.log(r,a,o);const l=this.__doAni(a,a.boudingRect,o.boudingRect),c=this.__doAni(o,a.boudingRect,o.boudingRect);n.push(l,c)}return n}}const z=new A;export{A as SharedElementPonyfill,z as sharedElementPonyfill};
